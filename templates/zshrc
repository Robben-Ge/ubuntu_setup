# PATH (from bash -> zsh)
export PATH="$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH"

# Conda (miniconda) â€” keep in sync with modules/17_conda.sh CONDA_DIR
[[ -f "$HOME/miniconda3/etc/profile.d/conda.sh" ]] && source "$HOME/miniconda3/etc/profile.d/conda.sh"

# Oh My Zsh
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="ys"

plugins=(git z sudo zsh-autosuggestions zsh-syntax-highlighting)
[[ -f $ZSH/oh-my-zsh.sh ]] && source $ZSH/oh-my-zsh.sh

# Vim-friendly defaults
export EDITOR=vim
export VISUAL=vim
bindkey -v

# ROS setup (auto-detect installed ROS version)
# Try to detect ROS_DISTRO from environment or find installed ROS
if [[ -z "${ROS_DISTRO:-}" ]]; then
  # Auto-detect ROS2 distro from /opt/ros/
  for distro in humble foxy galactic iron jazzy rolling; do
    if [[ -f /opt/ros/$distro/setup.zsh ]]; then
      export ROS_DISTRO=$distro
      break
    fi
  done
  # If no ROS2 found, try ROS1
  if [[ -z "${ROS_DISTRO:-}" ]]; then
    for distro in noetic melodic kinetic; do
      if [[ -f /opt/ros/$distro/setup.zsh ]]; then
        export ROS_DISTRO=$distro
        break
      fi
    done
  fi
fi

# Source ROS setup if found
if [[ -n "${ROS_DISTRO:-}" ]] && [[ -f /opt/ros/$ROS_DISTRO/setup.zsh ]]; then
  source /opt/ros/$ROS_DISTRO/setup.zsh
fi

# ROS2 argcomplete for zsh (only for ROS2)
if [[ -n "${ROS_DISTRO:-}" ]] && [[ -f /opt/ros/$ROS_DISTRO/share/ros2cli/environment/ros2-argcomplete.zsh ]]; then
  autoload -U +X compinit && compinit
  autoload -U +X bashcompinit && bashcompinit
  source /opt/ros/$ROS_DISTRO/share/ros2cli/environment/ros2-argcomplete.zsh
fi

# Alias for re-initializing completion if needed
alias init-comp="autoload -U +X compinit && compinit && autoload -U +X bashcompinit && bashcompinit && [[ -n \"\${ROS_DISTRO:-}\" ]] && [[ -f /opt/ros/\$ROS_DISTRO/share/ros2cli/environment/ros2-argcomplete.zsh ]] && source /opt/ros/\$ROS_DISTRO/share/ros2cli/environment/ros2-argcomplete.zsh"

# Random encouragement (low-noise)
if (( RANDOM % 3 == 0 )); then
  command -v fortune >/dev/null \
  && command -v cowsay >/dev/null \
  && command -v lolcat >/dev/null \
  && fortune | cowsay | lolcat
fi

# ========= Navigation =========
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# ========= Git =========
alias gs='git status -sb'
alias ga='git add'
alias gaa='git add .'
alias gc='git commit -m'

# ========= Docker =========
alias dps='docker ps'
alias dpsa='docker ps -a'
alias di='docker images'
alias dex='docker exec -it'
alias drm='docker rm'
alias drmi='docker rmi'

# ========= System =========
alias who='whoami && hostname && pwd'
alias sys='neofetch'
alias top='btop'

# ========= Pay Respects (command correction) =========
command -v pay-respects >/dev/null && eval "$(pay-respects zsh --alias fuck)"
